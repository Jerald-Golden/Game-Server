<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width" />
    <style>
        body {
            font-family: Tahoma, Geneva, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        h1 {
            background-color: #333;
            color: #fff;
            padding: 10px;
            text-align: center;
        }

        #player-list {
            margin: 20px;
            padding: 10px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .player {
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #fafafa;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
    </style>
    <!-- colyseus.js client -->
    <script src="https://unpkg.com/colyseus.js@^0.15.0/dist/colyseus.js"></script>
</head>

<body>
    <h1>Multiplayer Game - Players List</h1>
    <div id="player-list">
        <strong>Connected Players:</strong>
        <div id="players"></div>
    </div>
    <script>
        const host = window.document.location.host.replace(/:.*/, '');
        const client = new Colyseus.Client(
            location.protocol.replace('http', 'ws') +
            '//' +
            host +
            (location.port ? ':' + location.port : '')
        );
        let room;

        // Initialize player list container
        const playersContainer = document.getElementById('players');

        client.joinOrCreate("state_handler", { role: "observer" }).then((roomInstance) => {
            room = roomInstance;

            const players = {};

            function addPlayerUI(sessionId, player) {
                const playerElement = document.createElement('div');
                playerElement.className = 'player';
                playerElement.id = `player-${sessionId}`;
                updatePlayerUI(playerElement, sessionId, player);
                playersContainer.appendChild(playerElement);
            }

            function updatePlayerUI(element, sessionId, player) {
                element.innerHTML = `
            <strong>Player ${sessionId}</strong><br />
            Position: x: ${player.position.x.toFixed(
                    2
                )}, y: ${player.position.y.toFixed(
                    2
                )}, z: ${player.position.z.toFixed(2)}<br />
            Rotation: x: ${player.rotation.x.toFixed(
                    2
                )}, y: ${player.rotation.y.toFixed(
                    2
                )}, z: ${player.rotation.z.toFixed(2)}
          `;
            }

            function removePlayerUI(sessionId) {
                const playerElement = document.getElementById(`player-${sessionId}`);
                if (playerElement) {
                    playersContainer.removeChild(playerElement);
                }
            }

            room.state.players.onAdd(function (player, sessionId) {
                console.log('Player added:', sessionId, player);
                players[sessionId] = player;
                addPlayerUI(sessionId, player);

                player.position.onChange(() => {
                    const playerElement = document.getElementById(`player-${sessionId}`);
                    if (playerElement) {
                        updatePlayerUI(playerElement, sessionId, player);
                    }
                });

                player.rotation.onChange(() => {
                    const playerElement = document.getElementById(`player-${sessionId}`);
                    if (playerElement) {
                        updatePlayerUI(playerElement, sessionId, player);
                    }
                });
            });


            room.state.players.onRemove(function (player, sessionId) {
                console.log('Player removed:', sessionId);
                delete players[sessionId];
                removePlayerUI(sessionId);
            });
        });
    </script>
</body>

</html>